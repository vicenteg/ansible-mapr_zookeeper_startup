---
# tasks file for mapr_zookeeper_startup

- name: ensure mapr user owns /opt/mapr/zkdata
  become: yes
  become_user: root
  file: path=/opt/mapr/zkdata owner='{{mapr_admin_username}}' group='{{mapr_admin_username}}' mode=0750 state=directory

- name: start zookeeper on ZK nodes
  become: yes
  become_user: root
  service: name=mapr-zookeeper state=started enabled=yes
  register: zk_started

- name: wait for zookeeper to be listening
  wait_for: port=5181 delay=10 timeout=90

- name: wait for a few more seconds to let zookeepers initialize
  pause: seconds=5
  when: zk_started.changed
